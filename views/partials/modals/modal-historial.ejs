<!-- MODAL REGISTRAR ATENCIÓN -->
<div
  id="modalHistorial"
  class="hidden fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-50"
>
  <div class="bg-white/90 rounded-2xl shadow-xl w-[90%] max-w-2xl p-6 relative border border-[#E0E6E6]">
    <h2 class="text-2xl font-bold text-[#3F4A4C] mb-4">Registrar nueva atención</h2>

    <form id="formHistorial" action="/historial" method="POST" class="space-y-4">
      
      <!-- PACIENTE -->
      <div>
        <label class="text-sm font-medium text-[#3F4A4C]">Paciente</label>
        <select
          name="paciente_id"
          required
          class="w-full px-3 py-2 rounded-xl border border-[#E0E6E6] bg-white/70 outline-none focus:ring-2 focus:ring-[#A7D9B8]"
        >
          <option value="">Seleccione un paciente</option>
          <% if (pacientes && pacientes.length > 0) { %>
            <% pacientes.forEach(p => { %>
              <option value="<%= p.id %>"><%= p.nombre %> <%= p.apellido %> - <%= p.dni %></option>
            <% }) %>
          <% } %>
        </select>
      </div>

      <!-- MÉDICO -->
      <div>
        <label class="text-sm font-medium text-[#3F4A4C]">Médico</label>
        <select
          name="medico_id"
          required
          class="w-full px-3 py-2 rounded-xl border border-[#E0E6E6] bg-white/70 outline-none focus:ring-2 focus:ring-[#A7D9B8]"
        >
          <option value="">Seleccione un médico</option>
          <% if (medicos && medicos.length > 0) { %>
            <% medicos.forEach(m => { %>
              <option value="<%= m.id %>"><%= m.nombre %> <%= m.apellido %> - <%= m.especialidad %></option>
            <% }) %>
          <% } %>
        </select>
      </div>

      <!-- FECHA -->
      <div>
        <label class="text-sm font-medium text-[#3F4A4C]">Fecha de atención</label>
        <input
          type="date"
          name="fecha_atencion"
          required
          max="<%= new Date().toISOString().split('T')[0] %>"
          class="w-full px-3 py-2 rounded-xl border border-[#E0E6E6] bg-white/70 outline-none focus:ring-2 focus:ring-[#A7D9B8]"
        />
      </div>

      <!-- DIAGNÓSTICO -->
      <div>
        <label class="text-sm font-medium text-[#3F4A4C]">Diagnóstico</label>
        <textarea
          name="diagnostico"
          required
          rows="3"
          placeholder="Describa el diagnóstico..."
          class="w-full px-3 py-2 rounded-xl border border-[#E0E6E6] bg-white/70 outline-none focus:ring-2 focus:ring-[#A7D9B8]"
        ></textarea>
      </div>

      <!-- OBSERVACIONES -->
      <div>
        <label class="text-sm font-medium text-[#3F4A4C]">Observaciones</label>
        <textarea
          name="observaciones"
          rows="2"
          placeholder="Observaciones adicionales (opcional)..."
          class="w-full px-3 py-2 rounded-xl border border-[#E0E6E6] bg-white/70 outline-none focus:ring-2 focus:ring-[#A7D9B8]"
        ></textarea>
      </div>

      <!-- TRATAMIENTO -->
      <div>
        <label class="text-sm font-medium text-[#3F4A4C]">Tratamiento</label>
        <textarea
          name="tratamiento"
          rows="2"
          placeholder="Tratamiento prescrito (opcional)..."
          class="w-full px-3 py-2 rounded-xl border border-[#E0E6E6] bg-white/70 outline-none focus:ring-2 focus:ring-[#A7D9B8]"
        ></textarea>
      </div>

      <!-- BOTONES -->
      <div class="flex justify-end gap-4 pt-4">
        <button
          type="button"
          id="btnCerrarModalHistorial"
          class="px-4 py-2 rounded-xl border border-[#E0E6E6] bg-white/70 hover:bg-[#E0E6E6]/70 text-[#3F4A4C]"
        >
          Cancelar
        </button>
        <button
          type="submit"
          class="px-4 py-2 rounded-xl bg-[#A7D9B8] hover:bg-[#3F4A4C] text-white font-semibold"
        >
          Guardar atención
        </button>
      </div>
    </form>
  </div>
</div>

<!-- SCRIPT DE CONTROL -->
<script>
  const modalHistorial = document.getElementById("modalHistorial");
  const btnAddHistorial = document.getElementById("btnAddHistorial");
  const btnCerrarModalHistorial = document.getElementById("btnCerrarModalHistorial");

  if (btnAddHistorial) {
    btnAddHistorial.addEventListener("click", () => modalHistorial.classList.remove("hidden"));
  }
  if (btnCerrarModalHistorial) {
    btnCerrarModalHistorial.addEventListener("click", () => modalHistorial.classList.add("hidden"));
  }
</script>

